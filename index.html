<html>
<head>
<script src="https://fb.me/react-0.14.0.js"
   ></script>
<script src="https://fb.me/react-dom-0.14.0.js"
        ></script>
<script src="http://fb.me/JSXTransformer-0.13.0.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">


<!-- Latest compiled and minified JavaScript -->

<!-- Latest compiled and minified CSS -->

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
</head>
<style>
 
  body{
    margin: 0px;
    padding: 0px;
  }

 .left {
    background: green;
    height: 300px;
    color: white;
  font-size: 2em;
    -webkit-user-select: none;  /* Chrome all / Safari all */
  -moz-user-select: none;     /* Firefox all */
  -ms-user-select: none;      /* IE 10+ */
  user-select: none; 

}

.left:active{
    background: yellow;
}

.red:active{
    background: black;
}

.red {
  background: red;
  height: 300px;
  color: white;
  font-size: 2em;
    -webkit-user-select: none;  /* Chrome all / Safari all */
  -moz-user-select: none;     /* Firefox all */
  -ms-user-select: none;      /* IE 10+ */
  user-select: none; 
}

.container-fluid {
    position:absolute;
    bottom:0;
    left:0;
    width: 100%;
}

#score {
    border: 15px solid white;
    background: black;
    color: white;
    height: 100%;
    padding: 130px 100px 50px 50px;
 

}

#score h1  {
      font-size: 12vw !important; 
      margin: 0px;
    padding: 0px;

}

.scoreResult{
    border: 5px solid white;
    padding: 10px 5px 5px 5px;
}




</style>

<body>

  <div id="reg"/>

<script src="http://cdn.socket.io/socket.io-1.3.4.js"></script>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
  



<script type="text/javascript">


    var socket = io();



</script>

  <script type="text/jsx">

      
      var App = React.createClass(
      {
           getInitialState: function() {
           
                return {
                     userArray : [],
                     isPhone : false
                };
            },
            componentDidMount: function() {
                var isPhone;
                if (/Mobi/.test(navigator.userAgent)) {
                    isPhone = true;
                }else{
                    isPhone = false;
                }
                var _this = this;
                
                socket.on('currentState',function(data){
                    _this.setState({userArray : data, isPhone : isPhone});
                } 

                );

                socket.emit('getCurrentState');
            },
          render: function() {
            var _this = this;
            var view;
            if (_this.state.isPhone) {
              view = <RegComponent />;
            } else {
              view = <Score user={this.state.userArray}/>;
            }
   
        return (
          <div>
             {view}
          </div >
              );
          }
      
      });

      
      var Score = React.createClass({

        getDefaultProps: function() {
            return {
                user : ["1","2"]
            };
        },

        render: function() {
          return (

            <div id="score">
                <div className="scoreResult">
                     {this.props.user.map(function(result) {
                        return <h1 key={result.id}>{result.name} - {result.score}</h1>;
                })}
                </div>
            </div>
           
            );
        }
      
      });
      


      var RegComponent = React.createClass({
            getDefaultProps: function() {
                return {   
                    user :["",""]            
                };
            },
            getInitialState: function() {
                return {
                    playerNames : ["",""]
                };

            },
          

            componentDidMount: function(){
            
               
            },
        
            updatePlayerName1 : function(event){
                this.updateNames(event.target.value,0);
            },
             updatePlayerName2 : function(event){
               this.updateNames(event.target.value,1);
            },
            updateNames : function(name,id){
                var array = this.state.playerNames;
                array[id] = name;
                this.emitNames(id);
                this.setState(array);

            },

            updateScore1 : function(event){
             
                this.emitScore(1);
            },
            updateScore2 : function(event){
                this.emitScore(2);
            },
            emitNames :function(id){
                console.log("emmiting name "+ this.state.playerNames[id] + id)
                socket.emit('playerNameChanged',{id: id, name: this.state.playerNames[id]});

            },

            emitScore : function(playerId){
                console.log("emitting score " + playerId);
                socket.emit('score',{id:playerId});
            },
            render: function() {
              return (
                  <div >
              
                  <input type="text" onChange={this.updatePlayerName1} value={this.state.playerNames[0]} placeholder="Player 1 name"/>
                  <br/>
                  <input type="text" onChange={this.updatePlayerName2} value={this.state.playerNames[1]}  placeholder="Player 2 name"/>
                  <br/>
                  
  <br/>
               <div className="container-fluid">

                 <div className="row">
                    <div className="col-xs-6 left" onTouchStart={this.updateScore1}>{this.state.playerNames[0]} </div>
                    <div className="col-xs-6 red" onTouchStart={this.updateScore2} >{this.state.playerNames[1]} </div>
                </div>
                </div>
              
           

          </div>
              );
          }
      
      });
      
  
        
       ReactDOM.render(<App/>,reg);
     
  </script>
</body>

</html>